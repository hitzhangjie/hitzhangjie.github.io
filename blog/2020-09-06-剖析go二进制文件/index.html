<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="Webç«™ç‚¹æè¿°">
<title>
å‰–ægoäºŒè¿›åˆ¶æ–‡ä»¶ - ä»‹ç»
</title>




<script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5f24f50fc2418c0012d52ac3&product=inline-share-buttons" async="async">
</script>

<style>
 
[alt~=sharing] {
    border: 0px;
    box-shadow: none;
}
div#st-1 {
    text-align: unset;
}

 
div#st-1 .st-btn {
    height: 24px;
    padding: 0 4px;
}

div#st-1 .st-btn > img {
    top: 4.2px;
}

div#st-2 .st-btn {
    height: 24px;
    padding: 0 4px;
}

div#st-2 .st-btn > img {
    top: 4.2px;
}
</style>







        
        <meta property="og:title" content="å‰–ægoäºŒè¿›åˆ¶æ–‡ä»¶ - ä»‹ç»" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Webç«™ç‚¹æè¿°"/>
<meta property="og:url" content="https://www.hitzhangjie.pro/blog/2020-09-06-%E5%89%96%E6%9E%90go%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6/"/>
<meta property="og:site_name" content="ä»‹ç»"/>




<meta property="og:image" content="https://www.hitzhangjie.pro/home/me.jpg"/>

<meta property="og:image" content="https://www.hitzhangjie.pro/home/profile.jpg"/>




        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.24b21e0909abaf0ad62af509780fea401864367fe10c0d7ffcd89778c9dac466.css" integrity="sha256-JLIeCQmrrwrWKvUJeA/qQBhkNn/hDA1//NiXeMnaxGY=" crossorigin="anonymous" media="screen">




    <link rel="stylesheet" href="/custom.css" integrity="" crossorigin="anonymous" media="screen">

        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                

    <h1 class="bold-title is-1">åšå®¢</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/">ä¸»é¡µ</a>
            

            
            

            
                
            

            
                
            

            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://www.hitzhangjie.pro/projects/">
                  
                  
                  é¡¹ç›®
                  
                  
                  </a>
                
                
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://www.hitzhangjie.pro/blog/">
                  
                  è¿”å› åšå®¢
                  
                  </a>
                
                
            
            
            
            
            
            <a class="navbar-item" href="/#about">å…³äº</a>
            
            
            
            
            
            <a class="navbar-item" href="/#thanks">è‡´è°¢</a>
            
            
            
            

            
            
            <a class="navbar-item" href="/#contact">è”ç³»æ–¹å¼</a>
            
            

            
            
            
            
            <a class="navbar-item" href="https://www.hitzhangjie.pro/en/">English</a>
            
            

            
            
        </div>
    </nav>
    <hr>
</div>



                
    <div class="container">

        <h2 class="title is-1 top-pad strong-post-title">
            <a href="https://www.hitzhangjie.pro/blog/2020-09-06-%E5%89%96%E6%9E%90go%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6/">å‰–ægoäºŒè¿›åˆ¶æ–‡ä»¶</a>
        </h2>
        <div class="post-data">
            å‘è¡¨æ—¶é—´ï¼š2020-09-06 <br> 
            é˜…è¯»æ—¶é•¿ï¼š6 åˆ†é’Ÿ (2767å­—)
        </div>

        
        <div>
            <div>
            
            
            <p>
                æ ‡ç­¾ï¼š
                
                <a href="/tags/go">go</a>,
                
                <a href="/tags/disassembler">disassembler</a>,
                
                <a href="/tags/gapstone">gapstone</a>
                
            </p>
            
            </div>

            <div>
            <br>
            


<div style="display:flex;">
    <div>åˆ†äº«ï¼š</div>
    <div>
        <div class="sharethis-inline-share-buttons"></div>
    </div>
</div>


            </div>

        </div>

        
        

        
        <div> 
            
<aside>
    <hr/>
    <header>
    <b>ã€Šå‰–ægoäºŒè¿›åˆ¶æ–‡ä»¶ã€‹ç›®å½•ï¼š</b>
    <br/>
    </header>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ä¸ºä»€ä¹ˆè¦åæ±‡ç¼–">ä¸ºä»€ä¹ˆè¦åæ±‡ç¼–ï¼Ÿ</a></li>
        <li><a href="#ä»€ä¹ˆæ˜¯åæ±‡ç¼–">ä»€ä¹ˆæ˜¯åæ±‡ç¼–ï¼Ÿ</a></li>
        <li><a href="#ä»0åˆ°1æ„å»ºåæ±‡ç¼–å™¨">ä»0åˆ°1æ„å»ºåæ±‡ç¼–å™¨ï¼Ÿ</a></li>
        <li><a href="#å‚è€ƒå†…å®¹">å‚è€ƒå†…å®¹</a></li>
      </ul>
    </li>
  </ul>
</nav>
    <hr/>
</aside>


        </div>
   
        
        <div class="container markdown top-pad">
            
<h2 id="ä¸ºä»€ä¹ˆè¦åæ±‡ç¼–" class="anchor-link"><a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%8f%8d%e6%b1%87%e7%bc%96">ä¸ºä»€ä¹ˆè¦åæ±‡ç¼–ï¼Ÿ</a></h2>
<p>è¿™ç¯‡æ–‡ç« ä»‹ç»ä¸‹åæ±‡ç¼–çš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•ç”¨goè¯­è¨€å†™ä¸€ä¸ªç®€å•çš„åæ±‡ç¼–å™¨ã€‚æœ¬æ–‡çš„ç›®æ ‡å°±æ˜¯ä¸ºäº†å°½å¯èƒ½æè¿°ä¸‹åæ±‡ç¼–çš„çš„ç›¸å…³æ¦‚å¿µï¼Œä»¥åŠè®©è¯»è€…æœ‹å‹ä»¬äº†è§£goäºŒè¿›åˆ¶ç¨‹åºå†…éƒ¨å¤§è‡´æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<p>æ±‡ç¼–ä»£ç ä¸ä¼šæ’’è°ï¼Œé˜…è¯»æ±‡ç¼–ä»£ç èƒ½å¤Ÿè®©æˆ‘ä»¬æ›´ç»†è‡´åœ°äº†è§£å¤„ç†å™¨æ‰§è¡Œçš„æŒ‡ä»¤åˆ°åº•åšäº†ä»€ä¹ˆã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåæ±‡ç¼–å¾ˆé‡è¦çš„åŸå› ä¹‹ä¸€ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªäºŒè¿›åˆ¶ç¨‹åºï¼Œå¹¶ä¸”æ€€ç–‘å®ƒæœ‰ä¸€äº›æ¶æ„çš„è¡Œä¸ºï¼Œé€šè¿‡åæ±‡ç¼–æ¥ç ”ç©¶å®ƒå°±æ˜¯ä¸€ç§å¾ˆå¥½çš„é€”å¾„ã€‚å†æˆ–è€…ï¼Œå¦‚æœä½ åˆ†æä»£ç éš¾ä»¥å‘ç°æ€§èƒ½ç“¶é¢ˆï¼Œé‚£ä¹ˆåæ±‡ç¼–ä¹Ÿæ˜¯ä¸€ç§å¯ä»¥ç®€åŒ–åˆ†æçš„é€”å¾„ã€‚</p>
<p>å¦‚æœä½ æ‹…å¿ƒèƒ½ä¸èƒ½é˜…è¯»x86_64æ±‡ç¼–ä»£ç çš„é—®é¢˜ï¼Œå…¶å®ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†éƒ½ä¸èƒ½å¾ˆé¡ºç•…åœ°é˜…è¯»ã€‚ä½ ä¹Ÿæ²¡æœ‰å¿…è¦ä¸ºäº†ææ‡‚è¿™ç¯‡æ–‡ç« å»é˜…è¯»å…¶ä»–ä»»ä½•çš„æ±‡ç¼–ä»£ç ï¼Œä¸è¿‡å¦‚æœæœ‰æ±‡ç¼–åŸºç¡€çš„è¯ç¡®å®ä¼šæ„Ÿè§‰æ›´æœ‰æ„æ€ç‚¹ã€‚è¿™é‡Œæœ‰ä¸€ç¯‡ä»‹ç»æ±‡ç¼–åŸºç¡€çš„æ–‡ç«  <a href="https://www.nayuki.io/page/a-fundamental-introduction-to-x86-assembly-programming">A fundamental introduction to x86 assembly programming</a>ã€‚</p>

<h2 id="ä»€ä¹ˆæ˜¯åæ±‡ç¼–" class="anchor-link"><a href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%8f%8d%e6%b1%87%e7%bc%96">ä»€ä¹ˆæ˜¯åæ±‡ç¼–ï¼Ÿ</a></h2>
<p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯åæ±‡ç¼–å‘¢ï¼Ÿ</p>
<p>åæ±‡ç¼–ï¼Œå…¶å®æ˜¯å°†å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œé‡æ–°è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç çš„è¿‡ç¨‹ã€‚ä¸ºäº†è§£é‡Šæ¸…æ¥šï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘ä¸‹ä»æºä»£ç ç¼–è¯‘æ„å»ºçš„è¿‡ç¨‹ï¼š</p>
<p><img src="https://www.grant.pizza/CompilerDiagram.png" alt="assemble-process"></p>
<p>æ±‡ç¼–ä»£ç ï¼Œå…¶å®æ˜¯ä¸€ç§ä»‹äºæºä»£ç ã€æœºå™¨æŒ‡ä»¤ä¹‹é—´çš„ä¸­é—´ä»£ç è¡¨ç¤ºï¼Œè™½ç„¶å¤§å¤šæ•°æ±‡ç¼–æŒ‡ä»¤æ˜¯å’Œæœºå™¨æŒ‡ä»¤å¯¹åº”çš„ï¼Œä½†æ˜¯ä¹Ÿä¸ç»å¯¹ï¼Œæ¯”å¦‚goæ±‡ç¼–å°±æ˜¯ä¸€ç§è·Ÿæœºå™¨æŒ‡ä»¤æ²¡æœ‰æ˜æ˜¾å¯¹åº”å…³ç³»çš„æ±‡ç¼–å½¢å¼ã€‚è¯¦ç»†åœ°å¯ä»¥å‚è€ƒgo assemblerè®¾è®¡å¯¹åº”çš„go blogä¸€æ–‡ã€‚okï¼Œè¨€å½’æ­£ä¼ ã€‚ç¼–è¯‘å™¨é¦–å…ˆå°†æºä»£ç è½¬æ¢ä¸ºOS/æ¶æ„ç‰¹å®šçš„æ±‡ç¼–ä»£ç ï¼Œç„¶åå†é€šè¿‡æ±‡ç¼–å™¨å°†æ±‡ç¼–ä»£ç è½¬æ¢ä¸ºæœºå™¨æŒ‡ä»¤ã€‚ä»å­—é¢ä¸Šå°±å¯ä»¥çœ‹å‡ºdisassembleæ˜¯assembleçš„ä¸€ä¸ªé€†å‘çš„è¿‡ç¨‹ï¼Œä¿—ç§°åæ±‡ç¼–ã€‚</p>
<p><img src="https://www.grant.pizza/DisassemblerDiagram.png" alt="disassemble-process"></p>
<p>åº†å¹¸åœ°æ˜¯ï¼Œgoè¯­è¨€æœ‰ä¸€ä¸ªç›¸å¯¹æ ‡å‡†ã€å®Œæ•´çš„å·¥å…·é“¾ï¼Œæ±‡ç¼–ã€åæ±‡ç¼–éƒ½ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†æºç è½¬æ¢æˆæ±‡ç¼–ä»£ç æ¥æŸ¥çœ‹ï¼Œä¾‹å¦‚é€šè¿‡è¿è¡Œå‘½ä»¤ <code>go build -gcflags -S program.go</code>ã€‚å¦‚æœæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªç¼–è¯‘æ„å»ºå¥½çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œè¿™ä¸ªæ—¶å€™æƒ³æŸ¥çœ‹æ±‡ç¼–ä»£ç çš„è¯ï¼Œå°±å¾—é€šè¿‡åæ±‡ç¼–ï¼Œå¯ä»¥è¿è¡Œå‘½ä»¤ <code>go tool objdump binaryFile</code>ã€‚</p>
<p>å¦‚æœæƒ³äº†è§£å¦‚ä½•å®ç°æ±‡ç¼–ã€åæ±‡ç¼–çš„è¯ï¼Œè¿™ç¯‡æ–‡ç« å…¶å®å·²ç»å¯ä»¥ç»“æŸäº†ã€‚ä½†æ˜¯å¦‚æœæ¥è§£é‡Šä¸‹å¦‚ä½•ä»0åˆ°1æ„å»ºä¸€ä¸ªåæ±‡ç¼–å™¨çš„è¯ï¼Œè¿˜æ˜¯æœ‰æ„æ€çš„ã€‚</p>

<h2 id="ä»0åˆ°1æ„å»ºåæ±‡ç¼–å™¨" class="anchor-link"><a href="#%e4%bb%8e0%e5%88%b01%e6%9e%84%e5%bb%ba%e5%8f%8d%e6%b1%87%e7%bc%96%e5%99%a8">ä»0åˆ°1æ„å»ºåæ±‡ç¼–å™¨ï¼Ÿ</a></h2>
<p>é¦–å…ˆï¼Œä¸ºäº†æ„å»ºä¸€ä¸ªåæ±‡ç¼–å™¨ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“äºŒè¿›åˆ¶ç¨‹åºå¯¹åº”çš„ç›®æ ‡æœºå™¨æ¶æ„åŒ…å«çš„æ‰€æœ‰çš„æœºå™¨æŒ‡ä»¤ã€‚ä¸ºäº†å®ç°è¿™ä¸ªï¼Œæˆ‘ä»¬å¯èƒ½è¦å‚è€ƒç‰¹å®šæ¶æ„çš„æ‰‹å†Œæ¥æŸ¥é˜…åˆ°åº•æœ‰å¤šå°‘æœºå™¨æŒ‡ä»¤ã€‚å¦‚æœå¯¹è¿™ä¸ªä¸ç†Ÿæ‚‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚å…¶å®ï¼Œæœ‰å¾ˆå¤šç§å¾®å¤„ç†å™¨æ¶æ„ã€æ±‡ç¼–è¯­æ³•ã€æŒ‡ä»¤é›†ã€ç¼–ç æ¨¡å¼ï¼Œè€Œä¸”ä¸€ç›´åœ¨å˜ã€‚å…‰æŒæ¡è¿™äº›ä¸åŒæœºå™¨æ¶æ„åŒ…å«çš„æŒ‡ä»¤é›†å°±æ˜¯ä¸€ä¸ªå¾ˆå›°éš¾çš„äº‹æƒ…ï¼Œè‡³äºå¦‚ä½•å›°éš¾å¯ä»¥å‚è€ƒä¸‹è¿™ç¯‡æ–‡ç«  <a href="https://www.grant.pizza/DisassemblerDiagram.png">how many x86_64 instructions are there anyway</a>ã€‚</p>
<p>åº†å¹¸åœ°æ˜¯ï¼Œè¿™äº›ç¹é‡çš„å·¥ä½œåº”è¢«è§£å†³äº†ï¼Œåæ±‡ç¼–æ¡†æ¶Capstoneå°±æ˜¯å¹²è¿™ä¸ªäº‹æƒ…çš„ã€‚Capstoneå…¶å®å·²ç»æ˜¯ä¸€ä¸ªäº‹å®ä¸Šçš„æ ‡å‡†äº†ï¼Œåœ¨å„ç§åæ±‡ç¼–å·¥å…·ä¸­åº”ç”¨å¹¿æ³›ã€‚é‡æ–°å®ç°ä¸€ä¸ªåæ±‡ç¼–æ¡†æ¶ï¼Œå…¶å®æ²¡å¿…è¦ï¼Œè¿™ä¸ªè¿‡ç¨‹åªä¼šæ˜¯ä¸€ä¸ªå­¦ä¹ æ€§çš„ã€æ¯ç‡¥çš„ã€é‡å¤çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¸ä¼šä»‹ç»å¦‚ä½•å®ç°ä¸€ä¸ªCapstoneåæ±‡ç¼–æ¡†æ¶ï¼Œåªä¼šä»‹ç»å¦‚ä½•å€ŸåŠ©Capstoneæ¥å®ç°åæ±‡ç¼–çš„èƒ½åŠ›ã€‚åœ¨goè¯­è¨€ä¸­ä½¿ç”¨Capstoneä¹Ÿç®€å•ï¼Œæœ‰ä¸€ä¸ªé’ˆå¯¹goçš„å®ç°gapstoneã€‚</p>
<p>é€šè¿‡ä¸‹é¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªgapstoneåæ±‡ç¼–æ¡†æ¶å¼•æ“ï¼Œç”¨å®ƒæ¥æ‰§è¡Œåç»­çš„åæ±‡ç¼–ä»»åŠ¡ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">engine</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gapstone</span>.<span style="color:#a6e22e">New</span>(
	<span style="color:#a6e22e">gapstone</span>.<span style="color:#a6e22e">CS_ARCH_X86</span>,
	<span style="color:#a6e22e">gapstone</span>.<span style="color:#a6e22e">CS_MODE_64</span>,
)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
}
</code></pre></div><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸‹é¢çš„åŸå§‹æŒ‡ä»¤æ•°æ®ä¼ é€’ç»™Capstoneåæ±‡ç¼–æ¡†æ¶ï¼Œç„¶åè¯¥åæ±‡ç¼–æ¡†æ¶å°†ä¼šå°†è¿™äº›åŸå§‹æŒ‡ä»¤æ•°æ®è½¬æ¢ä¸ºå¯¹åº”çš„x86_64ä¸‹çš„æŒ‡ä»¤ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#ae81ff">0x64</span> <span style="color:#ae81ff">0x48</span> <span style="color:#ae81ff">0x8B</span> <span style="color:#ae81ff">0xC</span> <span style="color:#ae81ff">0x25</span> <span style="color:#ae81ff">0xF8</span> <span style="color:#ae81ff">0xFF</span> <span style="color:#ae81ff">0xFF</span> <span style="color:#ae81ff">0xFF</span>

                     |

<span style="color:#a6e22e">mov</span> <span style="color:#a6e22e">rcx</span>, <span style="color:#a6e22e">qword</span> <span style="color:#a6e22e">ptr</span> <span style="color:#a6e22e">fs</span>:[<span style="color:#ae81ff">0xfffffffffffffff8</span>]
</code></pre></div><p>æŠŠä¸Šé¢çš„æ“ä½œæ”¾åœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹ï¼š</p>
<p><strong>file: main.go</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">input</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">byte</span>{<span style="color:#ae81ff">0x64</span>, <span style="color:#ae81ff">0x48</span>, <span style="color:#ae81ff">0x8B</span>, <span style="color:#ae81ff">0xC</span>, <span style="color:#ae81ff">0x25</span>, <span style="color:#ae81ff">0xF8</span>, <span style="color:#ae81ff">0xFF</span>, <span style="color:#ae81ff">0xFF</span>, <span style="color:#ae81ff">0xFF</span>}

<span style="color:#a6e22e">instructions</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Disasm</span>(<span style="color:#a6e22e">input</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
}

<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">instruction</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">instructions</span> {
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;0x%x:\t%s\t\t%s\n&#34;</span>, <span style="color:#a6e22e">instruction</span>.<span style="color:#a6e22e">Address</span>, <span style="color:#a6e22e">instruction</span>.<span style="color:#a6e22e">Mnemonic</span>, <span style="color:#a6e22e">instruction</span>.<span style="color:#a6e22e">OpStr</span>)
}
</code></pre></div><p>æµ‹è¯•ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go run main.go

0x0:	mov		rcx, qword ptr fs:<span style="color:#f92672">[</span>0xfffffffffffffff8<span style="color:#f92672">]</span>
</code></pre></div><p>æœ‰äº†è¿™ä¸ªåæ±‡ç¼–æ¡†æ¶Capstoneä¹‹åï¼Œè¦å®ç°ä¸€ä¸ªåæ±‡ç¼–å™¨ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå‰©ä¸‹çš„å·¥ä½œè¦åšï¼Œå°±æ˜¯ä»äºŒè¿›åˆ¶ç¨‹åºä¸­æå–æŒ‡ä»¤å¯¹åº”çš„åŸå§‹æ•°æ®ï¼Œç„¶åå°†å…¶ä¼ ç»™Capstoneç¿»è¯‘å¼•æ“å°±å¯ä»¥äº†ã€‚</p>
<p>å½“ä½ åœ¨ä¸€ä¸ªç¬”è®°æœ¬ä¸Šç¼–è¯‘ä¸€ä¸ªgoç¨‹åºã€é»˜è®¤è¾“å‡ºæ˜¯64ä½ELFæ ¼å¼ï¼ˆExecutable Linkable Formatï¼‰ã€‚ELFå†…éƒ¨å…¶å®æ˜¯è¢«ç»„ç»‡æˆäº†å¤šä¸ªä¸åŒçš„èŠ‚ï¼ˆsectionï¼‰ï¼Œæ¯ä¸€ä¸ªsectionéƒ½æœ‰ä¸åŒçš„ç›®çš„ï¼Œå¦‚å­˜å‚¨ç‰ˆæœ¬ä¿¡æ¯ã€ç¨‹åºå…ƒæ•°æ®ä¿¡æ¯ã€å¯æ‰§è¡Œä»£ç ç­‰ç­‰ã€‚ELFæ˜¯è¢«å¹¿æ³›é‡‡ç”¨çš„ä¸€ä¸ªäºŒè¿›åˆ¶ç¨‹åºæ ‡å‡†ï¼Œgoè¯­è¨€æ ‡å‡†åº“é‡Œé¢æä¾›äº†ä¸€ä¸ª <code>debug/elf</code> packageç”¨æ¥è¿›è¡ŒELFæ–‡ä»¶æ•°æ®çš„è¯»å†™ã€‚ELFå…¶å®æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯è¦å®ç°åæ±‡ç¼–çš„è¯å…¶å®æˆ‘ä»¬åªå…³å¿ƒä¸¤ä¸ªsectionå°±å¯ä»¥äº†ã€‚ä¸€ä¸ªæ˜¯ç¬¦å·è¡¨sectionï¼ˆ.symtabï¼‰ï¼Œä¸€ä¸ªæ˜¯æŒ‡ä»¤section ï¼ˆ.textï¼‰ã€‚</p>
<p><img src="https://www.grant.pizza/ELF_64.png" alt="elf"></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœ¯è¯­symbolçš„å®šä¹‰ï¼Œå…¶å®å®ƒæŒ‡çš„æ˜¯ä»£ç ä¸­ä»»ä½•æœ‰åçš„ä¸œè¥¿ï¼Œå¦‚å˜é‡ã€å‡½æ•°ã€ç±»å‹ã€å¸¸é‡ç­‰éƒ½æ˜¯symbolsã€‚goç¼–è¯‘å™¨ä¼šç¼–è¯‘æ¯ä¸€ä¸ªç¬¦å·ï¼Œå¹¶å­˜å‚¨å¯¹ç¬¦å·è¡¨ä¸­ç¬¦å·çš„å¼•ç”¨ä¿¡æ¯ã€‚goæ ‡å‡†åº“ <code>debug/elf</code> ä¸­æä¾›äº†å¯¹ELFæ–‡ä»¶çš„è¯»å†™èƒ½åŠ›ï¼Œæ¯ä¸€ä¸ªç¬¦å·éƒ½é€šè¿‡ç»“æ„ä½“ <code>Symbol</code> æ¥è¡¨ç¤ºï¼Œå®ƒåŒ…æ‹¬äº†ç¬¦å·çš„åå­—ã€åœ°å€ã€åŸå§‹æ•°æ®çš„å¤šå°‘ç­‰ç­‰å§ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// A Symbol represents an entry in an ELF symbol table section.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Symbol</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Name</span>        <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">Info</span>        <span style="color:#66d9ef">byte</span>
	<span style="color:#a6e22e">Other</span>       <span style="color:#66d9ef">byte</span>
	<span style="color:#a6e22e">Section</span>     <span style="color:#a6e22e">SectionIndex</span>
	<span style="color:#a6e22e">Value</span>       <span style="color:#66d9ef">uint64</span>
	<span style="color:#a6e22e">Size</span>        <span style="color:#66d9ef">uint64</span>
}
</code></pre></div><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¿«é€Ÿæå–ELFæ–‡ä»¶ä¸­çš„æ‰€æœ‰ç¬¦å·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™ä¹ˆå®ç°ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Open the ELF file
</span><span style="color:#75715e"></span><span style="color:#a6e22e">elfFile</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">elf</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">path</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
  <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;error while opening ELF file %s: %+s&#34;</span>, <span style="color:#a6e22e">path</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
}

<span style="color:#75715e">// Extract the symbol table
</span><span style="color:#75715e"></span><span style="color:#a6e22e">symbolTable</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">elfFile</span>.<span style="color:#a6e22e">Symbols</span>()
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
  <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;could not extract symbol table: %s&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
}

<span style="color:#75715e">// Traverse through each symbol in the symbol table
</span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">symbol</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">symbolTable</span> {
	<span style="color:#75715e">/*
</span><span style="color:#75715e">	symbol.Info lets us tell if this symbol is a function that we want to disassemble
</span><span style="color:#75715e">	symbol.Value gives us the offset from the start of the .text section
</span><span style="color:#75715e">	symbol.Size lets us calculate the full address range of this symbol in the .text section
</span><span style="color:#75715e">	*/</span>
}
</code></pre></div><p>ä»Symbolå„ä¸ªå­—æ®µçš„åå­—å‘½åä¸Šçœ‹å¹¶ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œç¬¦å·å¯¹åº”çš„å†…å­˜åç§»é‡å…¶å®æ˜¯å­˜å‚¨åœ¨Valueå­—æ®µä¸­çš„ã€‚é€šè¿‡è¿™ä¸ªåç§»é‡ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—ä¸.text sectionçš„åç§»é‡çš„å·®å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºç¬¦å·å¯¹åº”çš„æŒ‡ä»¤æ•°æ®åœ¨.text sectionä¸­çš„èµ·å§‹ç´¢å¼•ã€‚é€šè¿‡è¿›ä¸€æ­¥çš„Sizeæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºåŒ…å«çš„æŒ‡ä»¤æ•°æ®å¯¹åº”çš„å­—èŠ‚æ•°é‡ã€‚è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯Infoå­—æ®µï¼Œè¿™ä¸ªå­—æ®µèµ·å§‹æ˜¯ç±»å‹çš„æ„æ€ï¼Œåœ¨goé‡Œé¢Info=byte(2)è¡¨ç¤ºçš„æ˜¯å‡½æ•°ï¼ŒInfo=byte(18)è¡¨ç¤ºçš„æ˜¯æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³å®ç°å¯¹å‡½æ•°ã€æ–¹æ³•çš„åæ±‡ç¼–çš„è¯ï¼Œæˆ‘ä»¬åªå¤„ç†è¿™ä¸¤ç§ç±»å‹çš„å°±å¯ä»¥äº†ã€‚</p>
<p><img src="https://www.grant.pizza/SymbolTableToTextSection.png" alt="Symbol"></p>
<p>æœ‰äº†è¿™äº›ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¿«é€Ÿçš„å†å®Œå–„ä¸€ä¸‹äº†ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// extract the .text section
</span><span style="color:#75715e"></span><span style="color:#a6e22e">textSection</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">elfFile</span>.<span style="color:#a6e22e">Section</span>(<span style="color:#e6db74">&#34;.text&#34;</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">textSection</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;No text section&#34;</span>)
}

<span style="color:#75715e">// extract the raw bytes from the .text section
</span><span style="color:#75715e"></span><span style="color:#a6e22e">textSectionData</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">textSection</span>.<span style="color:#a6e22e">Data</span>()
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
}

<span style="color:#75715e">// traverse through the symbol table
</span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">symbol</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">symbolTable</span> {

	<span style="color:#75715e">// skip over any symbols that aren&#39;t functinons/methods
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">symbol</span>.<span style="color:#a6e22e">Info</span> <span style="color:#f92672">!=</span> byte(<span style="color:#ae81ff">2</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">symbol</span>.<span style="color:#a6e22e">Info</span> <span style="color:#f92672">!=</span> byte(<span style="color:#ae81ff">18</span>) {
		<span style="color:#66d9ef">continue</span>
	}

	<span style="color:#75715e">// skip over empty symbols
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">symbol</span>.<span style="color:#a6e22e">Size</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">continue</span>
	}

	<span style="color:#75715e">// calculate starting and ending index of the symbol within the text section
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">symbolStartingIndex</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">symbol</span>.<span style="color:#a6e22e">Value</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">textSection</span>.<span style="color:#a6e22e">Addr</span>
	<span style="color:#a6e22e">symbolEndingIndex</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">symbolStartingIndex</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">symbol</span>.<span style="color:#a6e22e">Size</span>

	<span style="color:#75715e">// collect the bytes of the symbol
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">symbolBytes</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">textSectionData</span>[<span style="color:#a6e22e">symbolStartingIndex</span>:<span style="color:#a6e22e">symbolEndingIndex</span>]

	<span style="color:#75715e">// disasemble the symbol
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">instructions</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">Disasm</span>(<span style="color:#a6e22e">symbolBytes</span>, <span style="color:#a6e22e">symbol</span>.<span style="color:#a6e22e">Value</span>, <span style="color:#ae81ff">0</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;could not disasemble symbol: %s&#34;</span>, <span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// print out each instruction that&#39;s part of this symbol
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;\n\nSYMBOL %s\n&#34;</span>, <span style="color:#a6e22e">symbol</span>.<span style="color:#a6e22e">Name</span>)
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ins</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">instructions</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;0x%x:\t%s\t\t%s\n&#34;</span>, <span style="color:#a6e22e">ins</span>.<span style="color:#a6e22e">Address</span>, <span style="color:#a6e22e">ins</span>.<span style="color:#a6e22e">Mnemonic</span>, <span style="color:#a6e22e">ins</span>.<span style="color:#a6e22e">OpStr</span>)
	}
}
</code></pre></div><p>å®Œæ•´çš„å®ä¾‹ä»£ç ï¼Œè¯¦è§ <a href="https://gist.github.com/hitzhangjie/e91b92baed1b5108d5a4fe596ca2ae03">full disassembler</a>ã€‚å®ç°ä¸€ä¸ªç®€å•çš„åæ±‡ç¼–å™¨ï¼Œå®é™…ä¸Šåªç”¨äº†70~80è¡Œä»£ç è€Œå·²ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„è¿è¡Œå®ä¾‹ã€‚</p>
<p><img src="https://asciinema.org/a/P5SZTG7aXgZFzAI8df2yPaI0a.png" alt="disassembler example"></p>
<blockquote>
<p>Note: åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¸‹capstoneçš„ç‰ˆæœ¬ã€gapstaoneçš„ç‰ˆæœ¬ï¼Œä¸ç„¶æµ‹è¯•çš„æ—¶å€™å¯èƒ½ä¼šå‡ºé”™ã€‚è¿™é‡Œå…ˆæš‚æ—¶ä¸è¯¦ç»†å†™äº†ï¼Œé‡åˆ°é—®é¢˜å¯ä»¥å»repoä¸‹æŸ¥issueã€‚</p>
</blockquote>

<h2 id="å‚è€ƒå†…å®¹" class="anchor-link"><a href="#%e5%8f%82%e8%80%83%e5%86%85%e5%ae%b9">å‚è€ƒå†…å®¹</a></h2>
<p>1.dissecting go binaries, <a href="https://www.grant.pizza/dissecting-go-binaries">https://www.grant.pizza/dissecting-go-binaries</a></p>

        </div>
        

        
        <hr>
        <div style="float:right;">
        


<div style="display:flex;">
    <div>åˆ†äº«ï¼š</div>
    <div>
        <div class="sharethis-inline-share-buttons"></div>
    </div>
</div>


        </div>

        <br>
        <br>

    </div>

    
    
    <br>
    <br>
    <div style="height:auto;align:center;text-align:center;"> 
        <div>
            <img src="/common/xiaoqi.png" style="height:238px;margin-top:10px;margin-right:5px;"/>
            <img src="/common/qrcode.jpg" style="height:238px;margin-top:10px;"/>
            <img src="/common/yuanbao.png" style="height:238px;margin-top:10px;margin-left:5px;"/>
        </div>

        <div>
            <p>
                æ„Ÿè°¢æ‰“èµï¼Œå°ä¸ƒğŸ¶ã€å…ƒå®ğŸ±å¯ä»¥æ”¹å–„ä¼™é£Ÿå’¯ ğŸ˜˜
            </p>
        </div>


    </div>
    

    </br>
    </br>
    
    <div class="container disqus">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-www-hitzhangjie-pro" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>



                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            <a href="https://github.com/victoriadrake/hugo-theme-introduction/"><strong>Introduction</strong></a> ä¸»é¢˜ä¸º <a href="http://gohugo.io/">Hugo</a> è€Œè®¾ã€‚ç”±å¼€æºç¤¾ç¾¤è´¡çŒ®è€…ä»¥ <a href="https://victoria.dev"><i class="fa fa-heart"></i> å’Œ <i class="fa fa-coffee"></i></a> åˆ›é€ ã€‚
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://www.hitzhangjie.pro/js/bundle.2ee571453a8980175e10bda96bda797cc9c4e2e745e488df68d50cef5deb57ff.js" integrity="sha256-LuVxRTqJgBdeEL2pa9p5fMnE4udF5IjfaNUM713rV/8="></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-168027530-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>








        
        
        
        
    </body>
</html>
