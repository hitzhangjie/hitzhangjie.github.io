<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="Webç«™ç‚¹æè¿°">
<title>
goæºç å‰–æ-gotestå®ç° - ä»‹ç»
</title>




<script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5f24f50fc2418c0012d52ac3&product=inline-share-buttons" async="async">
</script>

<style>
 
[alt~=sharing] {
    border: 0px;
    box-shadow: none;
}
div#st-1 {
    text-align: unset;
}

 
div#st-1 .st-btn {
    height: 24px;
    padding: 0 4px;
}

div#st-1 .st-btn > img {
    top: 4.2px;
}

div#st-2 .st-btn {
    height: 24px;
    padding: 0 4px;
}

div#st-2 .st-btn > img {
    top: 4.2px;
}
</style>







        
        <meta property="og:title" content="goæºç å‰–æ-gotestå®ç° - ä»‹ç»" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Webç«™ç‚¹æè¿°"/>
<meta property="og:url" content="https://www.hitzhangjie.pro/blog/2020-02-23-go%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-gotest%E5%AE%9E%E7%8E%B0/"/>
<meta property="og:site_name" content="ä»‹ç»"/>




<meta property="og:image" content="https://www.hitzhangjie.pro/home/me.jpg"/>

<meta property="og:image" content="https://www.hitzhangjie.pro/home/profile.jpg"/>




        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.24b21e0909abaf0ad62af509780fea401864367fe10c0d7ffcd89778c9dac466.css" integrity="sha256-JLIeCQmrrwrWKvUJeA/qQBhkNn/hDA1//NiXeMnaxGY=" crossorigin="anonymous" media="screen">




    <link rel="stylesheet" href="/custom.css" integrity="" crossorigin="anonymous" media="screen">

        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                

    <h1 class="bold-title is-1">åšå®¢</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/">ä¸»é¡µ</a>
            

            
            

            
                
            

            
                
            

            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://www.hitzhangjie.pro/projects/">
                  
                  
                  é¡¹ç›®
                  
                  
                  </a>
                
                
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://www.hitzhangjie.pro/blog/">
                  
                  è¿”å› åšå®¢
                  
                  </a>
                
                
            
            
            
            
            
            <a class="navbar-item" href="/#about">å…³äº</a>
            
            
            
            
            
            <a class="navbar-item" href="/#thanks">è‡´è°¢</a>
            
            
            
            

            
            
            <a class="navbar-item" href="/#contact">è”ç³»æ–¹å¼</a>
            
            

            
            
            
            
            <a class="navbar-item" href="https://www.hitzhangjie.pro/en/">English</a>
            
            

            
            
        </div>
    </nav>
    <hr>
</div>



                
    <div class="container">

        <h2 class="title is-1 top-pad strong-post-title">
            <a href="https://www.hitzhangjie.pro/blog/2020-02-23-go%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-gotest%E5%AE%9E%E7%8E%B0/">goæºç å‰–æ-gotestå®ç°</a>
        </h2>
        <div class="post-data">
            å‘è¡¨æ—¶é—´ï¼š2020-02-23 <br> 
            é˜…è¯»æ—¶é•¿ï¼š7 åˆ†é’Ÿ (3054å­—)
        </div>

        
        <div>
            <div>
            
            
            <p>
                æ ‡ç­¾ï¼š
                
                <a href="/tags/go">go</a>,
                
                <a href="/tags/test">test</a>
                
            </p>
            
            </div>

            <div>
            <br>
            


<div style="display:flex;">
    <div>åˆ†äº«ï¼š</div>
    <div>
        <div class="sharethis-inline-share-buttons"></div>
    </div>
</div>


            </div>

        </div>

        
        

        
        <div> 
            

        </div>
   
        
        <div class="container markdown top-pad">
            
<h2 id="é—®é¢˜èƒŒæ™¯" class="anchor-link"><a href="#%e9%97%ae%e9%a2%98%e8%83%8c%e6%99%af">é—®é¢˜èƒŒæ™¯</a></h2>
<p>åœ¨go1.13å‡ºæ¥åä¸ä¹…ï¼Œæœ‰ä¸å°‘åŒå­¦é‡åˆ°äº†go testæŠ¥é”™çš„é—®é¢˜ â€œflag -test.timeout provided but not definedâ€ã€‚è¿™ä¸ªé—®é¢˜æ˜¯å¦‚ä½•å¼•èµ·çš„å‘¢ï¼Ÿ</p>
<ul>
<li>å…¬å¸å¾®æœåŠ¡ä»£ç ï¼Œé€šå¸¸æ˜¯å€ŸåŠ©ä»£ç ç”Ÿæˆå·¥å…·ç»Ÿä¸€ç”Ÿæˆçš„ï¼ŒåŒ…æ‹¬é’ˆå¯¹æ¥å£çš„æµ‹è¯•ç”¨ä¾‹ï¼›</li>
<li>åœ¨ç”Ÿæˆå•å…ƒæµ‹è¯•æ–‡ä»¶æ—¶ï¼Œå¦‚helloworld_test.goä¸­ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›æµ‹è¯•é€‰é¡¹å¦‚-timeoutã€-serviceã€-methodã€-targetã€-reqã€-rspç­‰ï¼›
ä¸Šè¿°å®šä¹‰çš„é€‰é¡¹ï¼Œåœ¨helloworld_test.goä¸­çš„func init()ä¸­æ‰§è¡Œflag.Parse()æ“ä½œå®Œæˆé€‰é¡¹è§£æã€‚</li>
</ul>
<p>è¿™æ˜¯è¢«æµ‹è¯•ä»£ç çš„ä¸€ç‚¹èƒŒæ™¯ä¿¡æ¯ï¼Œä¸Šè¿°æµ‹è¯•ä»£ç åœ¨go1.12ä¸­æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å½“å‡çº§åˆ°go1.13åï¼Œå°±å‡ºç°äº†ä¸Šè¿°â€œflag &hellip; provided but not definedâ€çš„é”™è¯¯ã€‚</p>

<h2 id="å®ç°ç»†èŠ‚" class="anchor-link"><a href="#%e5%ae%9e%e7%8e%b0%e7%bb%86%e8%8a%82">å®ç°ç»†èŠ‚</a></h2>
<p>go testå®ç°ç»†èŠ‚ï¼Œéœ€è¦è·Ÿè¸ªä¸€ä¸‹å‘½ä»¤go testçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå…·ä½“å¯¹åº”è¿™ä¸ªæºæ–‡ä»¶ï¼šsrc/cmd/go/internal/test/test.goã€‚</p>
<p>å‡å¦‚ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªpackageåä¸ºxxxxçš„goæ–‡ä»¶ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªpackageåä¸ºxxxx_testçš„_testæ–‡ä»¶ï¼Œå¦‚ï¼š</p>
<p>file: helloworld_test.go</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">xxxx_test</span>

<span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;testing&#34;</span>
<span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;xxxx&#34;</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestHelloWorld</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
	<span style="color:#a6e22e">xxxx</span>.<span style="color:#a6e22e">Hello</span>()
}

<span style="color:#75715e">/*
</span><span style="color:#75715e">func init() {
</span><span style="color:#75715e">    flag.Parse()
</span><span style="color:#75715e">}
</span><span style="color:#75715e">*/</span>

<span style="color:#75715e">/*
</span><span style="color:#75715e">func TestMain(m *testing.M) {
</span><span style="color:#75715e">    os.Exit(m.Run())
</span><span style="color:#75715e">}
</span><span style="color:#75715e">*/</span>
</code></pre></div><p>file: helloworld.go</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">xxxx</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Hello</span>() {
}
</code></pre></div><p>è¿™é‡Œçš„å®ä¾‹ä»£ç ï¼Œåšäº†é€‚å½“çš„ç®€åŒ–ï¼Œæ–¹ä¾¿å¤§å®¶æŸ¥çœ‹ã€‚ä¸ºäº†æ›´å¥½åœ°è·Ÿè¸ªgo testè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥è°ƒè¯•æ¨¡å¼è¿è¡Œgo testï¼Œå¦‚<code>GOTMPDIR=$(pwd)/xxx dlv exec $(which go) -- test -c</code>ï¼š</p>
<ul>
<li>é¦–å…ˆæŒ‡å®šäº†ä¸´æ—¶ç›®å½•GOTMPDIRä¸ºå½“å‰ç›®å½•ä¸‹çš„xxxï¼Œåœ¨æ‰§è¡Œç¼–è¯‘æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶å°†ç”Ÿæˆåˆ°è¯¥ç›®å½•ä¸‹ï¼›</li>
<li>dlvæ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨<code>--</code>åé¢æ·»åŠ ä¼ é€’ç»™è¢«è°ƒè¯•ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå¦‚è¿™é‡Œä¼ é€’ç»™goçš„å‚æ•°æ˜¯<code>test -c</code>ï¼›</li>
</ul>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ<code>fswatch $(pwd)/xxx</code>æ¥è·Ÿè¸ªæ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ï¼Œä»è€Œå¸®åŠ©æˆ‘ä»¬åˆ†ægo teståˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œè¿™æ ·æ¯”è¾ƒç›´è§‚ï¼Œç›´æ¥çœ‹æºç ï¼Œä»£ç é‡æœ‰ç‚¹å¤šï¼Œå®¹æ˜“æŠ“ä¸ä½å¤´ç»ªã€‚</p>
<p>æ¥ä¸‹æ¥åªéœ€è¦æ‰§è¡Œnextã€nextã€nextæ­¥è¿›çš„å½¢å¼æ‰§è¡Œgo testçš„ä»£ç é€»è¾‘å°±å¯ä»¥äº†ã€‚è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°fswatchè¾“å‡ºäº†å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">zhangjie@knight test $ fswatch .

/Users/zhangjie/test/test/xxx/go-build3964143485
/Users/zhangjie/test/test/xxx/go-build3964143485/b001
/Users/zhangjie/test/test/xxx/go-build3964143485/b001/_testmain.go
</code></pre></div><p>æ­¤æ—¶æŸ¥çœ‹ä¸‹_testmain.goçš„æ–‡ä»¶å†…å®¹ï¼š</p>
<p>file: _testmain.go</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#75715e">// Code generated by &#39;go test&#39;. DO NOT EDIT.
</span><span style="color:#75715e"></span>
<span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;os&#34;</span>

	<span style="color:#e6db74">&#34;testing&#34;</span>
	<span style="color:#e6db74">&#34;testing/internal/testdeps&#34;</span>

	<span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;xxxx&#34;</span>

	<span style="color:#a6e22e">_xtest</span> <span style="color:#e6db74">&#34;xxxx_test&#34;</span>
)

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tests</span> = []<span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">InternalTest</span>{
	{<span style="color:#e6db74">&#34;TestHelloWorld&#34;</span>, <span style="color:#a6e22e">_xtest</span>.<span style="color:#a6e22e">TestHelloWorld</span>},
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">benchmarks</span> = []<span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">InternalBenchmark</span>{
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">examples</span> = []<span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">InternalExample</span>{
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
	<span style="color:#a6e22e">testdeps</span>.<span style="color:#a6e22e">ImportPath</span> = <span style="color:#e6db74">&#34;xxxx&#34;</span>
}



<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {

	<span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">MainStart</span>(<span style="color:#a6e22e">testdeps</span>.<span style="color:#a6e22e">TestDeps</span>{}, <span style="color:#a6e22e">tests</span>, <span style="color:#a6e22e">benchmarks</span>, <span style="color:#a6e22e">examples</span>)

	<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Run</span>())
}
</code></pre></div><p>ä¸Šè¿°æ–‡ä»¶ä¸­åŒ…å«äº†ä¸€ä¸ªmainå‡½æ•°ï¼Œæ˜¯go test -cç”Ÿæˆçš„æµ‹è¯•ç¨‹åºçš„å…¥å£å‡½æ•°ã€‚</p>
<ul>
<li>
<p>ä¸Šè¿°æ–‡ä»¶ä¸­ï¼Œimportäº†æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ä¸¤ä¸ªpackageï¼Œå¦‚<code>import _ &quot;xxxx&quot;</code>ï¼Œä»¥åŠ<code>import _xtest &quot;xxxx_test&quot;</code>ï¼Œè¿™ä¸¤ä¸ªpackageçš„ä»£ç å°±æ˜¯æˆ‘ä»¬ä¸Šé¢ç»™å‡ºçš„ï¼Œä¸€ä¸ªHelloå‡½æ•°å®šä¹‰ï¼Œä¸€ä¸ªå¯¹Helloå‡½æ•°çš„å•å…ƒæµ‹è¯•ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚åœ¨helloworld_test.goä¸­æˆ‘ä»¬æ³¨é‡Šæ‰äº†ä¸¤æ®µä»£ç ï¼Œä¸€ä¸ªæ˜¯func init()é€»è¾‘ï¼Œä¸€ä¸ªæ˜¯func TestMain()é€»è¾‘ã€‚æˆ‘ä»¬ç¨åå†è¯´è¿™ä¸ªã€‚</p>
</li>
<li>
<p>func init()ä¸­ä¹Ÿæ²¡æœ‰ä»€ä¹ˆéœ€è¦å…³æ³¨çš„ã€‚</p>
</li>
<li>
<p>func mainä¸­ï¼Œå…ˆæ‰§è¡Œäº†ä¸€ä¸ªtesting.MainStart(&hellip;)åˆå§‹åŒ–é€»è¾‘ï¼Œè¿™é‡Œé¢èµ¶äº†ä»€ä¹ˆå‘¢ï¼Ÿå®ƒæ‰§è¡Œäº†ä¸€ä¸ªtesting.Init()å‡½æ•°ï¼Œæ¥åˆå§‹åŒ–go testingè¿™ä¸ªpackageä¸­è‡ªå®šä¹‰çš„ä¸€äº›flagsï¼Œå¦‚-test.timeoutä¹‹ç±»çš„ã€‚ä¸»æ„è¿™äº›flagsçš„æ³¨å†Œé€»è¾‘æ˜¯åœ¨æ‰€æœ‰packageçš„func init()æ‰§è¡Œä¹‹åæ‰å‘èµ·çš„ã€‚</p>
</li>
<li>
<p>func mainä¸­ï¼Œæ¥ç€æ‰§è¡Œäº†ä¸€ä¸ªos.Exit(m.Run())æ¥æ‰§è¡Œæµ‹è¯•ï¼Œå±•å¼€m.Run()èƒ½å¤Ÿçœ‹åˆ°æ ¹æ®-test.runé€‰æ‹©æ€§è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ–æ‰§è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„é€»è¾‘ã€‚æ³¨æ„ï¼Œå½“æˆ‘ä»¬åœ¨æµ‹è¯•æ–‡ä»¶ä¸­å®šä¹‰äº†TestMainæ–¹æ³•ä¹‹åï¼Œè¿™é‡Œç”Ÿæˆçš„ä»£ç å°±ä¸æ˜¯os.Exit(m.Run())äº†ï¼Œè€Œæ˜¯_xtest.TestMain(m),è¿™å°†å…è®¸å…ˆæ‰§è¡Œæˆ‘ä»¬è‡ªå·±çš„æµ‹è¯•ä»£ç è®¾ç½®é€»è¾‘ã€‚å¦‚åœ¨TestMainä¸­æ‰§è¡Œä¸€äº›å‡†å¤‡æµ‹è¯•æ•°æ®ã€å·¥ä½œç›®å½•ã€æ³¨å†Œå‘½ä»¤é€‰é¡¹ é€»è¾‘ã€‚</p>
</li>
</ul>

<h2 id="è¯¥é—®é¢˜äº§ç”ŸåŸå› " class="anchor-link"><a href="#%e8%af%a5%e9%97%ae%e9%a2%98%e4%ba%a7%e7%94%9f%e5%8e%9f%e5%9b%a0">è¯¥é—®é¢˜äº§ç”ŸåŸå› </a></h2>
<p>å¥½ï¼Œäº‹æƒ…è‡³æ­¤ï¼Œæˆ‘ä»¬å…ˆæ¥è§£ç­”æœ¬æ–‡å¼€å¤´é‡åˆ°çš„é—®é¢˜ï¼Ÿ</p>
<ul>
<li>go1.13ä¸­å¯¹testing packageçš„åˆå§‹åŒ–é€»è¾‘åšäº†ä¸€ç‚¹è°ƒæ•´ï¼Œå®ƒå°†flagsçš„åˆå§‹åŒ–é€»è¾‘æ”¾åœ¨äº†mainç¨‹åºä¸­ï¼Œæ‰€æœ‰çš„å…¶ä»–packageçš„func init()æ‰§è¡Œä¹‹åï¼›</li>
<li>goå®˜æ–¹å…¶å®ä¸å»ºè®®åœ¨func init()ä¸­å®šä¹‰ä¸€äº›flagsçš„ï¼Œé™¤éæ˜¯main packageã€‚ä½†æ˜¯æˆ‘ä»¬å¾ˆå¤šå¼€å‘å¹¶ä¸äº†è§£è¿™ä¸ªèƒŒæ™¯ï¼Œç»å¸¸åœ¨func init()ä¸­å®šä¹‰ä¸€äº›flagså¹¶Parseï¼Œç”šè‡³æ˜¯åœ¨_test.goæ–‡ä»¶ä¸­;</li>
<li>go1.13åšäº†ä¸Šè¿°è°ƒæ•´ä¹‹åï¼Œåœ¨func init()ä¸­æ‰§è¡Œflag.Parse()æ—¶ï¼Œå¦‚æœgo testä¼ é€’äº†ä¸€äº›è¿˜æ²¡æœ‰æ¥å¾—åŠæ³¨å†Œçš„é€‰é¡¹ï¼Œå¦‚-test.timeoutæ˜¯åœ¨func main()æ‰§è¡Œåæ³¨å†Œï¼Œå°±ä¼šæŠ¥é”™&quot;flag -test.timeout provided but not defined&rdquo;ã€‚</li>
</ul>
<p>åˆ°è¿™ï¼Œæˆ‘ä»¬è§£é‡Šäº†é—®é¢˜äº§ç”Ÿçš„åŸå› äº†ã€‚</p>

<h2 id="å¦‚ä½•è§„é¿è¯¥é—®é¢˜" class="anchor-link"><a href="#%e5%a6%82%e4%bd%95%e8%a7%84%e9%81%bf%e8%af%a5%e9%97%ae%e9%a2%98">å¦‚ä½•è§„é¿è¯¥é—®é¢˜</a></h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹å¦‚ä½•è§„é¿ä¸Šè¿°é—®é¢˜ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œç¡®å®æœ‰éœ€è¦åœ¨_test.goä¸­å®šä¹‰ä¸€äº›flagsè¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶çš„æƒ…å†µã€‚</p>
<p>æˆ‘ä»¬äº†è§£åˆ°ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰äº†TestMainå‡½æ•°ï¼Œgo testå°±ä¼šç”Ÿæˆè¿™æ ·çš„ä»£ç :</p>
<p>file: _testmain.go</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">MainStart</span>(<span style="color:#a6e22e">testdeps</span>.<span style="color:#a6e22e">TestDeps</span>(), <span style="color:#a6e22e">tests</span>, <span style="color:#a6e22e">benchmarks</span>, <span style="color:#a6e22e">examples</span>)

    <span style="color:#a6e22e">_xtest</span>.<span style="color:#a6e22e">TestMain</span>(<span style="color:#a6e22e">m</span>)
}
</code></pre></div><p>åœ¨testing.MainStartä¸­æ‰§è¡Œtestingæ¡†æ¶çš„é€‰é¡¹æ³¨å†Œé€»è¾‘ï¼Œå¦‚-test.runã€-test.timeoutç­‰ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨_xtestè¿™ä¸ªå¯¼å…¥åˆ«åå¯¹åº”packageä¸­å®šä¹‰å¥½flagsï¼Œå¯ä»¥åœ¨packageçº§åˆ«å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨func init()ä¸­å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨func TestMain()ä¸­å®šä¹‰ï¼Œåªè¦ä¿è¯ï¼Œæ‰§è¡Œflag.Parse()çš„æ—¶å€™æ˜¯åœ¨TestMainæˆ–è€…æ›´ä¹‹åçš„å•å…ƒæµ‹è¯•å‡½æ•°ä¸­å°±å¯ä»¥ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰çš„packageçš„é€‰é¡¹éƒ½æ­£å¸¸æ³¨å†Œäº†ï¼ŒåŒ…æ‹¬testing packageçš„ï¼Œåœ¨TestMainä¸­æ‰§è¡Œflag.Parse()å°±ä¸ä¼šå†å‡ºç°â€œflag &hellip; provided but not defined&quot;çš„å¥‡è‘©æƒ…å†µã€‚</p>

<h2 id="åŒºåˆ†testing-flagsä»¥åŠè‡ªå®šä¹‰flags" class="anchor-link"><a href="#%e5%8c%ba%e5%88%86testing-flags%e4%bb%a5%e5%8f%8a%e8%87%aa%e5%ae%9a%e4%b9%89flags">åŒºåˆ†testing flagsä»¥åŠè‡ªå®šä¹‰flags</a></h2>
<p>å¦å¤–ï¼Œå…³äºè‡ªå®šä¹‰flagä¸testing packageå®šä¹‰çš„é‡åçš„é—®é¢˜ï¼Œå…¶å®go testæ˜¯æœ‰è€ƒè™‘åˆ°çš„ï¼Œç”¨å‚æ•°&ndash;argsåˆ†å¼€å°±å¯ä»¥äº†ï¼Œå‰é¢çš„æ˜¯ç»™testingè§£æçš„ï¼Œåé¢æ˜¯ç»™è‡ªå®šä¹‰çš„è§£æçš„ï¼Œtestingè‡ªå·±çš„flagåå¸¦â€œtest.â€å‰ç¼€ï¼Œå…¶å®æ˜¯å¯ä»¥çœç•¥æ‰çš„ã€‚</p>

<h2 id="å†çœ‹go-testä»£ç ç”Ÿæˆ" class="anchor-link"><a href="#%e5%86%8d%e7%9c%8bgo-test%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90">å†çœ‹go testä»£ç ç”Ÿæˆ</a></h2>
<p>ä¸‹é¢æ˜¯é—®é¢˜çš„å›å½’ï¼ŒåŠå®šä½è¿‡ç¨‹ä¸­çš„æºç åˆ†æï¼</p>
<p>_testmain.goçš„ç”Ÿæˆï¼Œæ˜¯é€šè¿‡goæ¨¡æ¿æ¥ç”Ÿæˆçš„ï¼Œæ¨¡æ¿è·¯å¾„è¯¦è§ï¼šsrc/cmd/go/internal/load/test.goï¼Œæœç´¢å˜é‡â€™testmainTmplâ€™ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Code generated by &#39;go test&#39;. DO NOT EDIT.
</span><span style="color:#75715e"></span>
<span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;os&#34;</span>
{{<span style="color:#66d9ef">if</span> .<span style="color:#a6e22e">TestMain</span>}}
	<span style="color:#e6db74">&#34;reflect&#34;</span>
{{<span style="color:#a6e22e">end</span>}}
	<span style="color:#e6db74">&#34;testing&#34;</span>
	<span style="color:#e6db74">&#34;testing/internal/testdeps&#34;</span>

{{<span style="color:#66d9ef">if</span> .<span style="color:#a6e22e">ImportTest</span>}}
	{{<span style="color:#66d9ef">if</span> .<span style="color:#a6e22e">NeedTest</span>}}<span style="color:#a6e22e">_test</span>{{<span style="color:#66d9ef">else</span>}}<span style="color:#a6e22e">_</span>{{<span style="color:#a6e22e">end</span>}} {{.<span style="color:#a6e22e">Package</span>.<span style="color:#a6e22e">ImportPath</span> | <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;%q&#34;</span>}}
{{<span style="color:#a6e22e">end</span>}}
{{<span style="color:#66d9ef">if</span> .<span style="color:#a6e22e">ImportXtest</span>}}
	{{<span style="color:#66d9ef">if</span> .<span style="color:#a6e22e">NeedXtest</span>}}<span style="color:#a6e22e">_xtest</span>{{<span style="color:#66d9ef">else</span>}}<span style="color:#a6e22e">_</span>{{<span style="color:#a6e22e">end</span>}} {{.<span style="color:#a6e22e">Package</span>.<span style="color:#a6e22e">ImportPath</span> | <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;%s_test&#34;</span> | <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;%q&#34;</span>}}
{{<span style="color:#a6e22e">end</span>}}
<span style="color:#f92672">...</span>
)

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tests</span> = []<span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">InternalTest</span>{
{{<span style="color:#66d9ef">range</span> .<span style="color:#a6e22e">Tests</span>}}
	{<span style="color:#e6db74">&#34;{{.Name}}&#34;</span>, {{.<span style="color:#a6e22e">Package</span>}}.{{.<span style="color:#a6e22e">Name</span>}}},
{{<span style="color:#a6e22e">end</span>}}
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">benchmarks</span> = []<span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">InternalBenchmark</span>{
{{<span style="color:#66d9ef">range</span> .<span style="color:#a6e22e">Benchmarks</span>}}
	{<span style="color:#e6db74">&#34;{{.Name}}&#34;</span>, {{.<span style="color:#a6e22e">Package</span>}}.{{.<span style="color:#a6e22e">Name</span>}}},
{{<span style="color:#a6e22e">end</span>}}
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">examples</span> = []<span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">InternalExample</span>{
{{<span style="color:#66d9ef">range</span> .<span style="color:#a6e22e">Examples</span>}}
	{<span style="color:#e6db74">&#34;{{.Name}}&#34;</span>, {{.<span style="color:#a6e22e">Package</span>}}.{{.<span style="color:#a6e22e">Name</span>}}, {{.<span style="color:#a6e22e">Output</span> | <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;%q&#34;</span>}}, {{.<span style="color:#a6e22e">Unordered</span>}}},
{{<span style="color:#a6e22e">end</span>}}
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
	<span style="color:#a6e22e">testdeps</span>.<span style="color:#a6e22e">ImportPath</span> = {{.<span style="color:#a6e22e">ImportPath</span> | <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;%q&#34;</span>}}
}

<span style="color:#f92672">...</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#f92672">...</span>

	<span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">MainStart</span>(<span style="color:#a6e22e">testdeps</span>.<span style="color:#a6e22e">TestDeps</span>{}, <span style="color:#a6e22e">tests</span>, <span style="color:#a6e22e">benchmarks</span>, <span style="color:#a6e22e">examples</span>)
{{<span style="color:#a6e22e">with</span> .<span style="color:#a6e22e">TestMain</span>}}
	{{.<span style="color:#a6e22e">Package</span>}}.{{.<span style="color:#a6e22e">Name</span>}}(<span style="color:#a6e22e">m</span>)
	<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(int(<span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">m</span>).<span style="color:#a6e22e">Elem</span>().<span style="color:#a6e22e">FieldByName</span>(<span style="color:#e6db74">&#34;exitCode&#34;</span>).<span style="color:#a6e22e">Int</span>()))
{{<span style="color:#66d9ef">else</span>}}
	<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Run</span>())
{{<span style="color:#a6e22e">end</span>}}
}
</code></pre></div><p>ç»“åˆå‰é¢ç»™å‡ºçš„æµ‹è¯•ç”¨ä¾‹helloworld.goã€helloworld_test.goï¼Œä»¥åŠgo testç”Ÿæˆçš„_testmain.goï¼Œåªè¦å¯¹goæ¨¡æ¿ç¨æœ‰è®¤è¯†ï¼Œå°±å¾ˆå®¹æ˜“å»ºç«‹èµ·æ¨¡æ¿å’Œä»£ç ç”Ÿæˆçš„è”ç³»ï¼Œæ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ã€‚</p>

<h2 id="æ€»ç»“" class="anchor-link"><a href="#%e6%80%bb%e7%bb%93">æ€»ç»“</a></h2>
<p>go1.13 testing packageåˆå§‹åŒ–flagsé¡ºåºå‘ç”Ÿæ”¹å˜ï¼Œå¼•èµ·äº†ä¸€äº›go testæ—¶&quot;flag &hellip; provided but not defined&quot;çš„é”™è¯¯ï¼Œæš´éœ²äº†æˆ‘ä»¬ä¸€äº›å¼€å‘è€…å¯¹go testä¸ç†Ÿæ‚‰ã€å¯¹go flagså®˜æ–¹æ¨èç”¨æ³•ä¸ç†Ÿæ‚‰ã€‚æœ¬æ–‡è§£é‡Šäº†go testçš„å¤§è‡´å¤„ç†é€»è¾‘ã€é—®é¢˜äº§ç”ŸåŸå› ä»¥åŠè§„é¿è¯¥é—®é¢˜çš„å»ºè®®ã€‚</p>

        </div>
        

        
        <hr>
        <div style="float:right;">
        


<div style="display:flex;">
    <div>åˆ†äº«ï¼š</div>
    <div>
        <div class="sharethis-inline-share-buttons"></div>
    </div>
</div>


        </div>

        <br>
        <br>

    </div>

    
    
    <br>
    <br>
    <div style="height:auto;align:center;text-align:center;"> 
        <div>
            <img src="/common/xiaoqi.png" style="height:238px;margin-top:10px;margin-right:5px;"/>
            <img src="/common/qrcode.jpg" style="height:238px;margin-top:10px;"/>
            <img src="/common/yuanbao.png" style="height:238px;margin-top:10px;margin-left:5px;"/>
        </div>

        <div>
            <p>
                æ„Ÿè°¢æ‰“èµï¼Œå°ä¸ƒğŸ¶ã€å…ƒå®ğŸ±å¯ä»¥æ”¹å–„ä¼™é£Ÿå’¯ ğŸ˜˜
            </p>
        </div>


    </div>
    

    </br>
    </br>
    
    <div class="container disqus">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-www-hitzhangjie-pro" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>



                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            <a href="https://github.com/victoriadrake/hugo-theme-introduction/"><strong>Introduction</strong></a> ä¸»é¢˜ä¸º <a href="http://gohugo.io/">Hugo</a> è€Œè®¾ã€‚ç”±å¼€æºç¤¾ç¾¤è´¡çŒ®è€…ä»¥ <a href="https://victoria.dev"><i class="fa fa-heart"></i> å’Œ <i class="fa fa-coffee"></i></a> åˆ›é€ ã€‚
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://www.hitzhangjie.pro/js/bundle.2ee571453a8980175e10bda96bda797cc9c4e2e745e488df68d50cef5deb57ff.js" integrity="sha256-LuVxRTqJgBdeEL2pa9p5fMnE4udF5IjfaNUM713rV/8="></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-168027530-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>








        
        
        
        
    </body>
</html>
