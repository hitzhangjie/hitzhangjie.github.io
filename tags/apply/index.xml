<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>apply on</title><link>/tags/apply/</link><description>Recent content in apply on</description><generator>Hugo -- gohugo.io</generator><language>en-US</language><lastBuildDate>Thu, 06 Nov 2025 08:00:00 +0800</lastBuildDate><atom:link href="/tags/apply/index.xml" rel="self" type="application/rss+xml"/><item><title>git鬼故事 - How `git cherrypick` Works</title><link>/blog/how_git_cherrypick_works/</link><pubDate>Thu, 06 Nov 2025 08:00:00 +0800</pubDate><guid>/blog/how_git_cherrypick_works/</guid><description>git鬼故事 - How git cherrypick Works # 1. 问题背景 # 项目组内部同事想合并一个线上版本分支的一系列bugfix到下个待发布分支，于是执行了分支merge操作：git merge &amp;lt;branch&amp;gt;。由于存在多分支同时修改的情况，所以预料之中会出现一些合并冲突问题（merge conflicts），git设计上希望能减少认为干预，尽可能启发式地、自动化地去解决一些冲突，尽管如此我们已经有心理准备。
OK，这里我们暂时不去讨论git分支策略上的一些最佳实践或者不良实践，这里我们想讨论一个让人头疼的问题，“git merge”“git cherrypick”究竟靠谱、不靠谱？
之所以提出这个问题，是因为出现了一个出乎我们所有人意料的情况，git merge &amp;lt;branch&amp;gt;后：
有一个源文件中同样的处理逻辑（注意两次的代码稍有不同）竟然被追加了两次。 这两个分支独立修改(插入)后的内容在行号范围上是有重叠的，git没有报冲突。 git merge &amp;lt;branch&amp;gt;, git cherrypick &amp;lt;commit&amp;gt;都会导致相同的问题。 如果说合并一个差异很大的分支不是一个常规操作，cherrypick相比较之下则是使用更加频繁的一个操作，不管是从master cherrypick提交到其他分支，还是线上分支的bugfix backport到master分支，经常用到。巧的是，我们执行 git cherrypick &amp;lt;commit&amp;gt;也会导致上述问题。ps：这里的 &amp;lt;commit&amp;gt;就是涉及到重复的处理逻辑的提交号。
wtf，这直接挑战了很多10年git使用经验的开发者们，发生了什么，连gitd都不住了么？禁不住会问，git是如何设计的，merge、cherrypick乃至rebase、apply是如何工作的。接下来我会用几篇文章解释清楚。
2. 测试准备 # 尽管项目组的代码也没什么特别的分享价值，但是写分享还是要注意脱敏，所以我构造了一个可以复现这个问题的极简git仓库。 您可以通过以下脚本来重建这个测试用的git仓库 (git cp, cc, ck分别是git cherry-pick，git commit, git checkout的alias）：
#!/bin/bash -e mkdir git_mistake &amp;amp;&amp;amp; cd git_mistake git init # master branch touch f echo &amp;quot;apple from master&amp;quot; &amp;gt; f echo &amp;quot;banana from master&amp;quot; &amp;gt;&amp;gt; f git add f &amp;amp;&amp;amp; git cc -m 'add f from master' # feat branch (insert after line 2, [3,4] inserted ) git ck -b feat echo &amp;quot;aaa from feat&amp;quot; &amp;gt;&amp;gt; f echo &amp;quot;bbb from feat&amp;quot; &amp;gt;&amp;gt;f git add .</description></item></channel></rss>