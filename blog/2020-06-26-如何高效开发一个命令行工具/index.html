<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="Webç«™ç‚¹æè¿°">
<title>
å¦‚ä½•é«˜æ•ˆå¼€å‘ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· - ä»‹ç»
</title>




<script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5f24f50fc2418c0012d52ac3&product=inline-share-buttons" async="async">
</script>

<style>
 
[alt~=sharing] {
    border: 0px;
    box-shadow: none;
}
div#st-1 {
    text-align: unset;
}

 
div#st-1 .st-btn {
    height: 24px;
    padding: 0 4px;
}

div#st-1 .st-btn > img {
    top: 4.2px;
}

div#st-2 .st-btn {
    height: 24px;
    padding: 0 4px;
}

div#st-2 .st-btn > img {
    top: 4.2px;
}
</style>







        
        <meta property="og:title" content="å¦‚ä½•é«˜æ•ˆå¼€å‘ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· - ä»‹ç»" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Webç«™ç‚¹æè¿°"/>
<meta property="og:url" content="https://www.hitzhangjie.pro/blog/2020-06-26-%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/"/>
<meta property="og:site_name" content="ä»‹ç»"/>




<meta property="og:image" content="https://www.hitzhangjie.pro/home/me.jpg"/>

<meta property="og:image" content="https://www.hitzhangjie.pro/home/profile.jpg"/>




        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.b4f2dd2e4b598457569caeeedcb3ed7c33d1d66cc7964445a00df66235fc4d08.css" integrity="sha256-tPLdLktZhFdWnK7u3LPtfDPR1mzHlkRFoA32YjX8TQg=" crossorigin="anonymous" media="screen">




    <link rel="stylesheet" href="/custom.css" integrity="" crossorigin="anonymous" media="screen">

        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                

    <h1 class="bold-title is-1">åšå®¢</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/">ä¸»é¡µ</a>
            

            
            

            
                
            

            
                
            

            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://www.hitzhangjie.pro/projects/">
                  
                  
                  é¡¹ç›®
                  
                  
                  </a>
                
                
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://www.hitzhangjie.pro/blog/">
                  
                  è¿”å› åšå®¢
                  
                  </a>
                
                
            
            
            
            
            
            <a class="navbar-item" href="/#about">å…³äº</a>
            
            
            
            
            
            <a class="navbar-item" href="/#thanks">è‡´è°¢</a>
            
            
            
            

            
            
            <a class="navbar-item" href="/#contact">è”ç³»æ–¹å¼</a>
            
            

            
            
            
            
            <a class="navbar-item" href="https://www.hitzhangjie.pro/en/">English</a>
            
            

            
            
        </div>
    </nav>
    <hr>
</div>



                
    <div class="container">

        <h2 class="title is-1 top-pad strong-post-title">
            <a href="https://www.hitzhangjie.pro/blog/2020-06-26-%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/">å¦‚ä½•é«˜æ•ˆå¼€å‘ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·</a>
        </h2>
        <div class="post-data">
            å‘è¡¨æ—¶é—´ï¼š2020-06-26 <br> 
            é˜…è¯»æ—¶é•¿ï¼š5 åˆ†é’Ÿ (2256å­—)
        </div>

        
        <div>
            <div>
            
            
            <p>
                æ ‡ç­¾ï¼š
                
                <a href="/tags/go">go</a>,
                
                <a href="/tags/flag">flag</a>,
                
                <a href="/tags/flagset">flagset</a>,
                
                <a href="/tags/cmd">cmd</a>,
                
                <a href="/tags/cobra">cobra</a>
                
            </p>
            
            </div>

            <div>
            <br>
            


<div style="display:flex;">
    <div>åˆ†äº«ï¼š</div>
    <div>
        <div class="sharethis-inline-share-buttons"></div>
    </div>
</div>


            </div>

        </div>

        
        

        
        <div> 
            

        </div>
   
        
        <div class="container markdown top-pad">
            <p>æˆ‘ç»å¸¸ä¼šå¼€å‘ä¸€äº›å‘½ä»¤è¡Œå·¥å…·æ¥ååŠ©å¤„ç†ä¸€äº›äº‹æƒ…ï¼Œå¦‚å¼€å‘ä¸€ä¸ªä»£ç ç”Ÿæˆå·¥å…·å¿«é€Ÿç”ŸæˆæœåŠ¡ä»£ç ï¼Œæˆ–è€…å¼€å‘ä¸€ä¸ªå·¥å…·æ¥æ–¹ä¾¿ç®¡ç†githubä¸Šçš„å·¥å…·ï¼Œæˆ–è€…å¼€å‘ä¸€ä¸ªå·¥å…·rmæ¥æ›¿æ¢æ‰ä¸å®‰å…¨çš„rmï¼Œç­‰ç­‰ã€‚</p>
<p>å‘½ä»¤è¡Œå·¥å…·å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¯¹åŠŸèƒ½è¿›è¡Œåˆ†ç»„ï¼Œå¼€å‘å¤šä¸ªå‘½ä»¤ä¸åˆ©äºä½¿ç”¨ï¼Œåœ¨å‘½ä»¤ä¸­æ”¯æŒå­å‘½ä»¤æ˜¯ä¸€ä¸ªæ›´å¸¸è§ã€æ›´å‹å¥½çš„åšæ³•ï¼Œå¦‚go buildï¼Œgo toolï¼Œgo pprofï¼Œç­‰ç­‰ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›ä¸ºä¸åŒçš„å­å‘½ä»¤æ·»åŠ ä¸åŒçš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œå¦‚<code>go build -gcflags=</code>ï¼Œ<code>go pprof --seconds=</code>ï¼Œç­‰ç­‰ã€‚</p>

<h3 id="å¦‚ä½•æ”¯æŒå­å‘½ä»¤å­—å‘¢" class="anchor-link"><a href="#%e5%a6%82%e4%bd%95%e6%94%af%e6%8c%81%e5%ad%90%e5%91%bd%e4%bb%a4%e5%ad%97%e5%91%a2">å¦‚ä½•æ”¯æŒå­å‘½ä»¤å­—å‘¢ï¼Ÿ</a></h3>
<p>å‡å¦‚æˆ‘ä»¬å¼€å‘ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº <code>gox</code>ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½ä¸ºå®ƒæ·»åŠ ä¸€ä¸ªå­å‘½ä»¤<code>gox create</code>æ¥åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æœåŠ¡å·¥ç¨‹ï¼ŒåŒ…æ‹¬è‡ªåŠ¨ç”Ÿæˆå·¥ç¨‹ä¸‹çš„ä»£ç ã€‚</p>
<p>é‚£å¦‚ä½•ä¸ºå‘½ä»¤è¡Œç¨‹åº<code>gox</code>æ·»åŠ è¿™ä¸ªå­å‘½ä»¤å­—å‘¢ï¼Ÿ</p>
<p><code>gox</code>æ˜¯shellæœç´¢è·¯å¾„å®šä½åˆ°çš„ç¨‹åºï¼Œ<code>create</code>åªèƒ½æ˜¯shellä¼ é€’ç»™è¿›ç¨‹çš„ä¸€ä¸ªæ™®é€šå‚æ•°ï¼Œåœ¨<code>gox</code>ç¨‹åºå¯åŠ¨ä¹‹ååªèƒ½ä»<code>os.Args</code>æ¥è·å–è¯¥å‚æ•°ï¼Œä»¥åŠåç»­<code>gox create -protofile= -protodir</code>çš„å‚æ•°<code>-protofile</code>åŠ<code>-protodir</code>ã€‚</p>
<p>ç„¶åå‘¢ï¼Œä¸ºäº†æ–¹ä¾¿ä»¥åæ‰©å±•å…¶ä»–å­å‘½ä»¤ï¼Œæˆ‘ä»¬æœ€å¥½å°†subcmdè¿›è¡Œä¸€ä¸‹æŠ½è±¡ï¼Œé€šè¿‡ä¸€ä¸ª<code>Command interface{}</code>çº¦å®šå¥½ä¸€ä¸ªsubcmdå¿…é¡»è¦å®Œæˆé‚£äº›æ“ä½œã€‚æ¥å£å¹¶ä¸æ˜¯ä¸ºäº†æŠ½è±¡è€ŒæŠ½è±¡ï¼Œè€Œæ˜¯ç”¨æ¥æ¸…æ™°åœ°è¡¨æ˜è¦åšä»€ä¹ˆã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Command what does a command do
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Command</span> <span style="color:#66d9ef">interface</span>{

    <span style="color:#75715e">// PreRun run before the command logic execution
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">PreRun</span>() <span style="color:#66d9ef">error</span>

    <span style="color:#75715e">// Run run the command logic
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Run</span>() <span style="color:#66d9ef">error</span>

    <span style="color:#75715e">// PostRun run after the command logic execution
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">PostRun</span>() <span style="color:#66d9ef">error</span>
}

<span style="color:#75715e">// BaseCommand basic implemention
</span><span style="color:#75715e">//
</span><span style="color:#75715e">// this BaseCommand could be embeded into a customized subcmd
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BaseCommand</span> <span style="color:#66d9ef">struct</span>{
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">bc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BaseCommand</span>) <span style="color:#a6e22e">PreRun</span>() <span style="color:#66d9ef">error</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">bc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BaseCommand</span>) <span style="color:#a6e22e">Run</span>() <span style="color:#66d9ef">error</span> {
    panic(<span style="color:#e6db74">&#34;implement me&#34;</span>)
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">bc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BaseCommand</span>) <span style="color:#a6e22e">PostRun</span>() <span style="color:#66d9ef">error</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>Commandæ¥å£å®šä¹‰äº†ä¸€ä¸ªcommandåº”è¯¥å¹²ä»€ä¹ˆï¼Œç„¶åä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªåŸºæœ¬çš„Commandå®ç°BaseCommandï¼Œå®ƒæä¾›äº†ä¸€äº›åŸºæœ¬çš„æ“ä½œå¯ä»¥ä¾›åç»­å¤ç”¨ï¼Œåé¢æˆ‘ä»¬è¦æ‰©å±•å…¶ä»–å­å‘½ä»¤å­—çš„æ—¶å€™ï¼Œé€šè¿‡å°†è¯¥BaseCommandåµŒå…¥ï¼Œå¯ä»¥å°‘å®ç°å‡ ä¸ªå‡½æ•°ï¼Œè¿™ä¹Ÿæ˜¯goé‡Œé¢æå€¡çš„é€šè¿‡ç»„åˆæ¥å®ç°ç»§æ‰¿ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å®ç°ä¸€ä¸ªCreateCmdï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">CreateCmd</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#f92672">*</span><span style="color:#a6e22e">BaseCommand</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCreateCmd</span>() <span style="color:#a6e22e">Command</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">CreateCmd</span>{
        <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">BaseCommand</span>{},
    }
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">CreateCmd</span>) <span style="color:#a6e22e">Run</span>() <span style="color:#66d9ef">error</span> {

    println(<span style="color:#e6db74">&#34;create cmd running&#34;</span>)

    <span style="color:#75715e">// execute the logic of create cmd
</span><span style="color:#75715e"></span>
    println(<span style="color:#e6db74">&#34;create cmd finished&#34;</span>)
}
</code></pre></div><p>é‚£æˆ‘ä»¬æ€ä¹ˆåœ¨æ‰§è¡Œ<code>gox create</code>çš„æ—¶å€™è¿è¡Œ<code>CreateCmd.Run()</code>æ–¹æ³•å‘¢ï¼Ÿ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cmds</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">Command</span> = {
    <span style="color:#e6db74">&#34;create&#34;</span>: <span style="color:#a6e22e">NewCreateCmd</span>,
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {

    <span style="color:#a6e22e">args</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Args</span>[<span style="color:#ae81ff">1</span>:]
    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">args</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
        panic(<span style="color:#e6db74">&#34;invalid subcmd&#34;</span>)
    }

    <span style="color:#a6e22e">cmd</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmds</span>[<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>]]
    <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
        panic(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;cmd: %s not registered&#34;</span>, <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>]))
    }

    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">PreRun</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        panic(<span style="color:#a6e22e">err</span>)
    }
    
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">Run</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        panic(<span style="color:#a6e22e">err</span>)
    }

    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">PostRun</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        panic(<span style="color:#a6e22e">err</span>)
    }

}
</code></pre></div><p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿæœ¬æ¥å°±å¾ˆç®€å• :)</p>

<h3 id="å¦‚ä½•ä¸ºå­å‘½ä»¤å­—æ·»åŠ ä¸åŒçš„é€‰é¡¹å‘¢" class="anchor-link"><a href="#%e5%a6%82%e4%bd%95%e4%b8%ba%e5%ad%90%e5%91%bd%e4%bb%a4%e5%ad%97%e6%b7%bb%e5%8a%a0%e4%b8%8d%e5%90%8c%e7%9a%84%e9%80%89%e9%a1%b9%e5%91%a2">å¦‚ä½•ä¸ºå­å‘½ä»¤å­—æ·»åŠ ä¸åŒçš„é€‰é¡¹å‘¢ï¼Ÿ</a></h3>
<p>é‚£ç°åœ¨è¦ç»™å„ä¸ªå­å‘½ä»¤å­—æ·»åŠ ç‹¬ç«‹çš„å‘½ä»¤è¡Œé€‰é¡¹æ€ä¹ˆåŠå‘¢ï¼Ÿæ¯”å¦‚<code>gox create</code>çš„å‘½ä»¤å‚æ•°å’Œ<code>gox update</code>çš„å‘½ä»¤è¡Œå‚æ•°æ˜¯ä¸åŒçš„ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿä½ å½“ç„¶å¯ä»¥æ ¹æ®os.Args[1:]æ¥è§£æï¼Œæƒ³æ€ä¹ˆè§£æéƒ½å¯ä»¥ï¼Œæˆ‘ä»¬è¿™é‡Œè®¨è®ºå¦‚ä½•å€ŸåŠ©goæ ‡å‡†åº“æä¾›çš„flagåŒ…æ¥è§£æã€‚</p>
<p>å¤§å®¶å¯èƒ½éƒ½ä½¿ç”¨è¿‡<code>flag.Parse()</code>æ¥è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®æ˜¯å°†os.Args[1:]ä¸­çš„å‚æ•°è§£æå®Œåå¡«å……åˆ°ä¸€ä¸ªé»˜è®¤çš„flagsetã€‚å¦‚æœè¦ä¸ºä¸åŒçš„å­å‘½ä»¤æ·»åŠ ä¸åŒçš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œé‚£ä¹ˆä¸ºæ¯ä¸ªå­å‘½ä»¤åˆ›å»ºç‹¬ç«‹çš„flagsetå°±å¯ä»¥äº†ã€‚å„ä¸ªå­å‘½ä»¤ä½¿ç”¨è‡ªå·±çš„flagsetæ¥æ‰§è¡Œ<code>flagset.Parse()</code>ä»£æ›¿<code>flag.Parse()</code>å°±å¯ä»¥äº†ã€‚</p>
<p>å°±è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬å¯¹å‰é¢çš„ç¨‹åºè¿›è¡Œä¸€ç‚¹è°ƒæ•´ï¼š</p>
<p>Commandæ¥å£å¢åŠ å‘½ä»¤å‚æ•°è§£ææ¥å£ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Command what does a command do
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Command</span> <span style="color:#66d9ef">interface</span>{

    <span style="color:#75715e">// ParseFlags parse flags into command&#39;s own flagset
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ParseFlags</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Args</span>)

    <span style="color:#f92672">...</span>
}
</code></pre></div><p>BaseCommand æ·»åŠ ä¸€ä¸ªå‚æ•°è§£æçš„æ–¹æ³•ï¼Œç»™è‡ªå®šä¹‰å­å‘½ä»¤å­—å¤ç”¨</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// BaseCommand basic implemention
</span><span style="color:#75715e">//
</span><span style="color:#75715e">// this BaseCommand could be embeded into a customized subcmd
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BaseCommand</span> <span style="color:#66d9ef">struct</span>{
    <span style="color:#a6e22e">flagSet</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">FlagSet</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">bc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BaseCommand</span>) <span style="color:#a6e22e">ParseFlags</span>(<span style="color:#a6e22e">args</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Args</span>) <span style="color:#66d9ef">error</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">bc</span>.<span style="color:#a6e22e">flagset</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#a6e22e">args</span>)
}

<span style="color:#f92672">...</span>
</code></pre></div><p>ä¸ºcreateå­å‘½ä»¤åˆ›å»ºç‹¬ç«‹çš„flagsetæ¥è§£æå‚æ•°</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCreateCmd</span>() <span style="color:#66d9ef">error</span> {

    <span style="color:#a6e22e">fs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">NewFlagSet</span>(<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">PanicOnError</span>),
    <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;protofile&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;protofile to process&#34;</span>)
    <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;protodir&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;protofile to searchï¼‰&#34;</span>

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">CreateCmd</span>{
        <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">BaseCommand</span>{
            <span style="color:#a6e22e">flagSet</span>: <span style="color:#a6e22e">fs</span>,
        }
    }
}
</code></pre></div><p>ç¨‹åºå¯åŠ¨çš„æ—¶å€™ç»Ÿä¸€è§£æå‘½ä»¤è¡Œå‚æ•°ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {

    <span style="color:#f92672">...</span>

    <span style="color:#75715e">// parse the flags
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">ParseFlags</span>(<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">1</span>:]; <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        panic(<span style="color:#a6e22e">err</span>)
    }

    <span style="color:#f92672">...</span>
}
</code></pre></div><p>è¿™æ ·å°±å®Œæˆäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œæœ¬æ¥å°±å¾ˆç®€å•ã€‚</p>

<h3 id="å¦‚ä½•æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©ä¿¡æ¯" class="anchor-link"><a href="#%e5%a6%82%e4%bd%95%e6%98%be%e7%a4%ba%e5%91%bd%e4%bb%a4%e5%b8%ae%e5%8a%a9%e4%bf%a1%e6%81%af">å¦‚ä½•æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©ä¿¡æ¯ï¼Ÿ</a></h3>
<p>å½“ç„¶äº†ï¼Œåªèƒ½è¿è¡Œå‘½ä»¤è¿˜ä¸è¡Œï¼Œæœ‰å¤šå°‘æ³¨å†Œçš„å­å‘½ä»¤å¯æ‰§è¡Œï¼Ÿæ¯ä¸ªå­å‘½ä»¤æœ‰ä»€ä¹ˆå‘½ä»¤è¡Œå‚æ•°å‘¢ï¼Ÿæˆ‘ä»¬è¿˜éœ€è¦èƒ½å¤Ÿæ˜¾ç¤ºå‘½ä»¤è¡Œçš„å¸®åŠ©ä¿¡æ¯ã€‚</p>
<p>è¿™ä¸ªæ€ä¹ˆå®ç°å‘¢ï¼Ÿå„ä¸ªå­å‘½ä»¤éœ€è¦èƒ½å¤ŸæŒ‡æ˜å‘½ä»¤çš„ä½¿ç”¨å¸®åŠ©ï¼š</p>
<ul>
<li>ä¸€ä¸ªç®€å•çš„è¡¨è¿°ï¼Œä»¥ä¾›æˆ‘ä»¬æ˜¾ç¤º<code>gox</code>åŒ…å«çš„å„ä¸ªå­å‘½ä»¤å­—çš„ä½¿ç”¨ä¿¡æ¯ï¼›</li>
<li>ä¸€ä¸ªè¯¦ç»†çš„æè¿°ï¼Œä»¥ä¾›æˆ‘ä»¬æ˜¾ç¤º<code>gox help create</code>æ—¶çš„å„ä¸ªé€‰é¡¹çš„å¸®åŠ©ä¿¡æ¯ï¼›</li>
</ul>
<p>æˆ‘ä»¬çš„ä»£ç ç®€å•åšä¸‹è°ƒæ•´å°±å¯ä»¥æ”¯æŒåˆ°ã€‚</p>
<p>æ·»åŠ Usageã€UsageLongæ–¹æ³•ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Command</span> <span style="color:#66d9ef">interface</span>{

    <span style="color:#f92672">...</span>

    <span style="color:#75715e">// è¿”å›ç®€å•çš„å¸®åŠ©ä¿¡æ¯
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Usage</span>() <span style="color:#66d9ef">string</span>
    
    <span style="color:#75715e">// è¿”å›è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">UsageLong</span>() <span style="color:#66d9ef">string</span>
}
</code></pre></div><p>ç„¶åä¸ºBaseCommandæ·»åŠ ä¸¤ä¸ªå­—æ®µï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BaseCommand</span> <span style="color:#66d9ef">struct</span>{
    <span style="color:#f92672">...</span>
    <span style="color:#a6e22e">Usage</span> <span style="color:#66d9ef">string</span>
    <span style="color:#a6e22e">UsageLong</span> <span style="color:#66d9ef">string</span>
}

<span style="color:#f92672">...</span>

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">bc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BaseCommand</span>) <span style="color:#a6e22e">Usage</span>() <span style="color:#66d9ef">string</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">bc</span>.<span style="color:#a6e22e">Usage</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">bc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BaseCommand</span>) <span style="color:#a6e22e">UsageLong</span>() <span style="color:#66d9ef">string</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">bc</span>.<span style="color:#a6e22e">UsageLong</span>
}
</code></pre></div><p>ä¸ºcreateCmdæ·»åŠ å¸®åŠ©ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCreateCmd</span>() <span style="color:#a6e22e">Command</span> {

    <span style="color:#a6e22e">fs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">NewFlagSet</span>(<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">PanicOnError</span>),
    <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;protofile&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;protofile to process&#34;</span>)
    <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;protodir&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;protofile to searchï¼‰&#34;</span>

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">CreateCmd</span>{
        <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">BaseCommand</span>{
            <span style="color:#a6e22e">flagSet</span>: <span style="color:#a6e22e">fs</span>,
            <span style="color:#a6e22e">Usage</span>: <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">create</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">project</span><span style="color:#960050;background-color:#1e0010">&#39;</span>,
            <span style="color:#a6e22e">UsageLong</span>: <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">create</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">project</span> <span style="color:#a6e22e">quickly</span>.<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">n</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">n</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">+</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">FlagUsages</span>(),
        }
    }

}
</code></pre></div><p>ç„¶åå‘¢ï¼Œä¸ºäº†èƒ½å¤Ÿä½¿ç”¨å¸®åŠ©ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªhelpå‘½ä»¤å­—ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">HelpCmd</span> <span style="color:#66d9ef">struct</span>{
    <span style="color:#a6e22e">cmd</span> <span style="color:#66d9ef">string</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewHelpCmd</span>() <span style="color:#a6e22e">Command</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">HelpCmd</span>{
        <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">BaseCommand</span>{},
    }
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HelpCmd</span>) <span style="color:#a6e22e">ParseFlags</span>(<span style="color:#a6e22e">args</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Args</span>) <span style="color:#66d9ef">error</span> {
    <span style="color:#a6e22e">cmd</span> = <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">1</span>:]
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">HelpCmd</span>) <span style="color:#a6e22e">Run</span>() <span style="color:#66d9ef">error</span> {

    <span style="color:#75715e">// help specific subcmd
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">cmd</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
        <span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmds</span>[<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">cmd</span>]
        <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;cmd: %s not registered&#34;</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">cmd</span>)
        }
        println(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">UsageLong</span>())
    }

    <span style="color:#75715e">// help all subcmds
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">cmds</span> {
        println(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Usage</span>())
    }
}
</code></pre></div><p>ç„¶åå‘¢ï¼Œæˆ‘ä»¬ä¸»ç¨‹åºå¯åŠ¨çš„æ—¶å€™æ‰§è¡Œ<code>gox</code> æˆ– <code>gox help</code>éƒ½æ‰§è¡Œhelpå‘½ä»¤ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {

    <span style="color:#a6e22e">args</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Args</span>[<span style="color:#ae81ff">1</span>:]
    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">args</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
        <span style="color:#a6e22e">cmds</span>[<span style="color:#e6db74">&#34;help&#34;</span>].<span style="color:#a6e22e">Run</span>()
    }
    <span style="color:#f92672">...</span>
}
</code></pre></div><p>å—¯ï¼Œå°±è¿™äº›äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿæœ¬æ¥å°±å¾ˆç®€å•ã€‚</p>

<h3 id="å°ç»“" class="anchor-link"><a href="#%e5%b0%8f%e7%bb%93">å°ç»“</a></h3>
<p>å½“ç„¶ï¼Œé™¤äº†è¿™äº›ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜å¸Œæœ›ä¸ºå‘½ä»¤è¡Œå·¥å…·æ·»åŠ shell auto-completionè¾“å…¥è¡¥å…¨åŠŸèƒ½ï¼Œæç¤ºä¿¡æ¯çš„å›½é™…åŒ–ã€æœ¬åœ°åŒ–ï¼Œå‘½ä»¤å­—æ‰©å±•æ—¶çš„ä¾¿åˆ©ç¨‹åº¦ç­‰ï¼Œè¿˜æ˜¯æœ‰äº›é—®é¢˜éœ€è¦è¿›ä¸€æ­¥è€ƒè™‘çš„ã€‚</p>
<p>æˆ‘è¿™é‡Œåªæ˜¯ä»‹ç»ä¸‹å®ç°çš„ä¸€ä¸ªå¤§è‡´æ€è·¯ï¼Œå…·ä½“å®è·µçš„æ—¶å€™å€’å¹¶ä¸ä¸€å®šè¦è¿™ä¹ˆå»å®ç°ï¼Œå¯ä»¥è€ƒè™‘ä¸‹cobraï¼Œé€šè¿‡cobraæ¥å®ç°posixé£æ ¼çš„å‘½ä»¤è¡Œæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚è¿™äº›å†…å®¹æ„Ÿå…´è¶£çš„è¯å¯ä»¥è‡ªå·±äº†è§£ä¸‹ã€‚</p>
<p>å’Œæœ¬æ–‡å†…å®¹æ¥è¿‘çš„ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ä¸€ä¸ªå·¥å…·<a href="https://github.com/hitzhangjie/rm">rm-safe</a>ï¼Œå¸Œæœ›å¯¹è¯»è€…æœ‹å‹æœ‰å¸®åŠ©ï¼</p>

        </div>
        

        
        <hr>
        <div style="float:right;">
        


<div style="display:flex;">
    <div>åˆ†äº«ï¼š</div>
    <div>
        <div class="sharethis-inline-share-buttons"></div>
    </div>
</div>


        </div>

        <br>
        <br>

    </div>

    
    
    <br>
    <br>
    <div style="height:auto;align:center;text-align:center;"> 
        <div>
            <img src="/common/xiaoqi.png" style="height:238px;margin-top:10px;margin-right:5px;"/>
            <img src="/common/qrcode.jpg" style="height:238px;margin-top:10px;"/>
            <img src="/common/yuanbao.png" style="height:238px;margin-top:10px;margin-left:5px;"/>
        </div>
        <div>
            <p>
                æ„Ÿè°¢æ‰“èµï¼Œå°ä¸ƒğŸ¶ã€å…ƒå®ğŸ±å¯ä»¥æ”¹å–„ä¼™é£Ÿå’¯ ğŸ˜˜
            </p>
        </div>
    </div>
    

    </br>
    </br>
    


                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            <a href="https://github.com/victoriadrake/hugo-theme-introduction/"><strong>Introduction</strong></a> ä¸»é¢˜ä¸º <a href="http://gohugo.io/">Hugo</a> è€Œè®¾ã€‚ç”±å¼€æºç¤¾ç¾¤è´¡çŒ®è€…ä»¥ <a href="https://victoria.dev"><i class="fa fa-heart"></i> å’Œ <i class="fa fa-coffee"></i></a> åˆ›é€ ã€‚
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://www.hitzhangjie.pro/js/bundle.f1741e9868b2f697e71cf8fccfcc12166540999b3d36f8fb9edd0882ba425d55.js" integrity="sha256-8XQemGiy9pfnHPj8z8wSFmVAmZs9Nvj7nt0IgrpCXVU="></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-168027530-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>








        
        
        
        
    </body>
</html>
